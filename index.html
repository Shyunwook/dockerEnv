<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Remote terminal</title>

    <link rel="stylesheet" href="./node_modules/xterm/css/xterm.css" />

    <script src="./node_modules/xterm/lib/xterm.js"></script>
    <script src="./node_modules/xterm-addon-fit/lib/xterm-addon-fit.js"></script>
    <script src="./node_modules/xterm-addon-attach/lib/xterm-addon-attach.js"></script>

    <style>
      div#terminal {
        width: 500px;
        height: 300px;
      }
    </style>
  </head>
  <body>
    <div id="terminal-container"></div>

    <script>
      var term, socket, fit, resize;
      window.onload = function () {
        term = new Terminal({ cols: 80, rows: 24 });
        const fitAddon = new FitAddon.FitAddon();

        term.loadAddon(fitAddon);
        term.open(document.querySelector("#terminal-container", true));
        fitAddon.fit();

        let sockHost = "127.0.0.1";
        let sockPort = 3000;

        socket = new WebSocket("ws://" + sockHost + ":" + sockPort);
        socket.onopen = () => {
          const attachAddon = new AttachAddon.AttachAddon(socket);
          term.loadAddon(attachAddon);
          // term.write("Hello from \x1B[1;3;31mxterm.js\x1B[0m $ ");
        };
        socket.onerror = (e) => {
          throw e;
        };

        // fit = () => {
        //   term.fit();
        //   setTimeout(() => {
        //     sendSizeToServer();
        //   }, 50);
        // };

        // resize = (cols, rows) => {
        //   term.resize(cols, rows);
        //   sendSizeToServer();
        // };

        // function sendSizeToServer() {
        //   let cols = term.cols.toString();
        //   let rows = term.rows.toString();
        //   while (cols.length < 3) {
        //     cols = "0" + cols;
        //   }
        //   while (rows.length < 3) {
        //     rows = "0" + rows;
        //   }
        //   socket.send("ESCAPED|-- RESIZE:" + cols + ";" + rows);
        // }
      };

      window.terminalRemote = new Terminal({
        role: "client",
        parentId: "terminal-container",
        host: "127.0.0.1",
        port: 3000,
      });

      // Wait for terminal to be initialized then resize it to fit in the container
      // setTimeout(() => {
      //   term.fit();
      // }, 500);
    </script>
  </body>
</html>
